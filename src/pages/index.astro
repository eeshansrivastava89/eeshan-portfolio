---
import PageLayout from '../layouts/BaseLayout.astro'
import { Icon } from 'astro-icon/components'

import { Image } from 'astro:assets'
import profile from '../assets/profile.jpg'

import fs from 'fs'
import yaml from 'js-yaml'
import path from 'path'

// Load social links
const socialLinksYaml = fs.readFileSync(
	path.join(process.cwd(), 'src/data/social-links.yaml'),
	'utf8'
)
const socialData = yaml.load(socialLinksYaml) as {
	socialLinks: Array<{ name: string; url: string; icon: string; label: string }>
}
const socialLinks = socialData.socialLinks

// Load projects
import { getLiveProjects, getProjectsByStatus } from '../../packages/shared/src/lib/projects'
import { getAllProjects } from '../../packages/shared/src/data/projectLoader'
import ProjectCard from '../../packages/shared/src/components/ProjectCard.astro'
import Timeline from '../../packages/shared/src/components/Timeline.astro'

// Load posts
import { getAllPosts, sortMDByDate } from '@/utils'
import PostPreview from '@/components/writing/PostPreview.astro'

const allPosts = await getAllPosts()
const recentPosts = sortMDByDate(allPosts).slice(0, 3)

const allProjects = getAllProjects()
const liveProjects = getLiveProjects(allProjects)
const inProgressProjects = getProjectsByStatus(allProjects, 'in-progress')
const activeProjects = [...liveProjects, ...inProgressProjects] // Cards for live + in-progress
const upcomingProjects = getProjectsByStatus(allProjects, 'coming-soon')
---

<PageLayout meta={{ title: 'Home' }}>
	<div class='w-full'>

		<!-- ============================================ -->
		<!-- HERO: Compact horizontal card                -->
		<!-- ============================================ -->
			<section class='border border-border bg-primary-foreground p-4 sm:p-6 shadow-lg shadow-black/5'>
				<div class='flex flex-col items-center gap-6 sm:flex-row sm:items-start'>
					<!-- Profile Image -->
					<Image
						src={profile}
						alt='profile photo'
						class='h-28 w-28 shrink-0 rounded-full bg-[#FFBE98] p-1.5'
						loading='eager'
					/>

					<!-- Name + Tagline + Socials -->
					<div class='flex flex-col items-center gap-4 sm:items-start'>
						<div class='text-center sm:text-left'>
							<h1 class='text-2xl font-bold sm:text-3xl'>Eeshan Srivastava</h1>
							<p class='mt-1 text-lg text-muted-foreground'>
							Engineer x Data Scientist x Leader
						</p>
						<!-- Social Links + Newsletter -->
						<div class='flex flex-wrap items-center gap-x-3 gap-y-3'>
							{
								socialLinks.map((link) => (
									<a
										href={link.url}
										target='_blank'
										class='flex h-9 w-9 items-center justify-center rounded-full border border-border bg-background transition-all hover:bg-input'
										aria-label={link.label}
									>
										<Icon name={link.icon} class='h-4 w-4' />
									</a>
								))
							}
							<span class='text-muted-foreground'>|</span>
							<a
							href='https://0to1datascience.substack.com'
								target='_blank'
								class='group flex items-center gap-2 text-sm'
							>
								<Icon name='simple-icons:substack' class='h-4 w-4 shrink-0' />
								<span class='text-muted-foreground'>Newsletter</span>
								<span class='font-medium text-foreground transition group-hover:translate-x-0.5'>Follow →</span>
							</a>
						</div>
					</div>
				</div>
			</section>

			<!-- ============================================ -->
			<!-- PHILOSOPHY                                   -->
			<!-- ============================================ -->
			<section class='mt-8 sm:mt-10 border-l-2 border-amber-400 pl-4 sm:pl-6 space-y-4'>
				<!-- Section heading with tight tracking -->
			<h2 class='text-xl sm:text-2xl font-bold text-foreground tracking-tight'><span class='font-serif italic text-amber-700 dark:text-amber-400'>0→1 Data Science.</span> From applications to analysis.</h2>
				<!-- Subtle divider -->
				<div class='border-t border-border/50 pt-4'>
					<p class='text-base text-muted-foreground'>
						Hi, I'm Eeshan, and welcome to my personal data science lab. I believe the best way to understand data is to <span class='italic bg-amber-200/60 dark:bg-amber-400/25 px-1'>build the system that creates it</span>. This site is my workshop
						where I practice the full loop: design the concept, build a working app, wire up analytics, do deep research, publish the findings, and iterate based on what the data actually says. 
					</p>
					<p class='text-base text-muted-foreground mt-4'>
						The goal isn't to replace experts. It's to build <span class='italic bg-amber-200/60 dark:bg-amber-400/25 px-1'>product intuition, technical credibility, and empathy</span> by practicing the feedback loop end-to-end. Everything here is <a href='https://github.com/eeshansrivastava89/datascienceapps' target='_blank' class='underline hover:text-foreground'>open-source</a> and non-commercial. If you're learning to build, you can <a href='https://0to1datascience.substack.com' target='_blank' class='underline hover:text-foreground'>follow along</a> or <a href='/contribute' class='underline hover:text-foreground'>contribute</a>.
					</p>
					<p class='text-base text-muted-foreground mt-4'>
						I use AI to build faster, but the product decisions, architecture choices, and analysis approach come from my own skills and experience.
					</p>
				</div>
			</section>

			<!-- ============================================ -->
			<!-- PROJECTS                                     -->
			<!-- ============================================ -->
			<section class='mt-8 sm:mt-10 space-y-4'>
				<h2 class='text-xl sm:text-2xl font-bold text-foreground'>Projects</h2>
				<p class='text-base text-muted-foreground'>Each app applies a data science method to a real problem. Interact, contribute data, explore the published analysis.</p>
				<div class='space-y-3'>
					{activeProjects.map((project) => (
						<ProjectCard project={project} variant='compact' />
					))}
				</div>
				
				<!-- What's Next Timeline (coming-soon only) -->
				{upcomingProjects.length > 0 && (
					<div class='mt-6'>
						<Timeline 
							inProgressProjects={[]} 
							upcomingProjects={upcomingProjects} 
						/>
					</div>
				)}
			</section>

			<!-- ============================================ -->
			<!-- RECENT POSTS                                 -->
			<!-- ============================================ -->
			<section class='mt-8 sm:mt-10 space-y-4'>
				<h2 class='text-xl sm:text-2xl font-bold text-foreground'>Recent Posts</h2>
				{recentPosts.length > 0 ? (
					<ul class='flex flex-col gap-y-3 list-none p-0 m-0'>
						{recentPosts.map((post) => (
							<PostPreview post={post} />
						))}
					</ul>
				) : (
					<p class='text-muted-foreground'>No posts yet.</p>
				)}
				<a 
					href='/writing' 
					class='inline-block text-sm text-muted-foreground hover:text-foreground transition'
				>
					View all posts →
				</a>
			</section>

			<!-- ============================================ -->
			<!-- NEWSLETTER SIGNUP                            -->
			<!-- Opens Substack with email pre-filled         -->
			<!-- ============================================ -->
			<section class='mt-8 sm:mt-10'>
				<div class='border border-border bg-primary-foreground p-4 sm:p-8'>
					<div class='flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between'>
						<div class='flex items-start gap-3'>
							<Icon name='simple-icons:substack' class='h-6 w-6 mt-0.5 shrink-0 text-[#FF6719]' />
							<div class='space-y-1'>
								<h2 class='text-xl font-bold text-foreground'>Sign up for my Newsletter</h2>
							<p class='text-sm text-muted-foreground'>Behind-the-scenes of 0→1 data science. What works, what breaks, what I'm learning.</p>
							</div>
						</div>
						<form 
							class='flex w-full gap-2 sm:w-auto'
							id="newsletter-form"
						onsubmit="event.preventDefault(); const email = this.email.value; if(email) window.open('https://0to1datascience.substack.com/subscribe?email=' + encodeURIComponent(email), '_blank');"
						>
							<input 
								type="email" 
								name="email" 
								placeholder="you@email.com" 
								required
								class='flex-1 sm:w-64 px-4 py-2.5 text-sm border border-border bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-foreground/20 focus:border-foreground transition-all'
							/>
							<button 
								type="submit" 
								class='shrink-0 px-5 py-2.5 text-sm font-medium bg-foreground text-background hover:bg-foreground/90 transition-all hover:-translate-y-0.5'
							>
								Subscribe
							</button>
						</form>
					</div>
				</div>
			</section>

	</div>
</PageLayout>
