---
import PageLayout from '../layouts/BaseLayout.astro'
import Card from '../components/Card.astro'
import FormattedDate from '../components/FormattedDate.astro'
import { Icon } from 'astro-icon/components'

import { Image } from 'astro:assets'
import profile from '../assets/profile.jpg'

import { getAllPosts, sortMDByDate, getUniqueTagsWithCount } from '../utils'
import fs from 'fs'
import yaml from 'js-yaml'
import path from 'path'

// Load social links
const socialLinksYaml = fs.readFileSync(path.join(process.cwd(), 'src/data/social-links.yaml'), 'utf8')
const socialData = yaml.load(socialLinksYaml) as { socialLinks: Array<{ name: string; url: string; icon: string; label: string }> }
const socialLinks = socialData.socialLinks

// Load posts
const allPosts = await getAllPosts()
const sortedPosts = sortMDByDate(allPosts)
const recentPost = sortedPosts[0]
const tags = getUniqueTagsWithCount(sortedPosts)
---

<PageLayout meta={{ title: 'Home' }}>
	<div class='flex w-full flex-col gap-y-12'>
		<!-- Hero Section -->
		<section class='flex flex-col items-center gap-y-6 text-center'>
			<!-- Profile Image -->
			<Image
				src={profile}
				alt='profile photo'
				class='rounded-full bg-[#FFBE98] p-2'
				style='height: 200px; width: auto;'
				loading='eager'
			/>

			<!-- Name -->
			<h1 class='text-4xl font-bold'>Eeshan S.</h1>

			<!-- Subtitle -->
			<p class='max-w-lg text-lg text-muted-foreground'>
				Data science leader building data-driven products at scale
			</p>

			<!-- Social Links Icons Row -->
			<div class='flex gap-x-4'>
				{socialLinks.map((link) => (
					<a
						href={link.url}
						target='_blank'
						class='flex h-10 w-10 items-center justify-center rounded-full bg-primary-foreground border border-border transition-all hover:bg-input'
						aria-label={link.label}
					>
						<Icon name={link.icon} class='h-5 w-5' />
					</a>
				))}
			</div>

			<!-- Utility Section: Two Column Layout -->
			<div class='w-full grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-0'>
				<!-- Left Column: Substack CTA -->
				<a
					href='https://scienceofmarketinganalytics.substack.com'
					target='_blank'
					class='flex items-center rounded-xl md:rounded-r-none bg-orange-50 border border-orange-200 md:border-r-0 px-6 py-4 transition-all duration-200 hover:bg-orange-100 hover:border-orange-300 hover:shadow-md group'
				>
					<div class='flex-1'>
						<div class='flex items-center gap-x-3 mb-2'>
							<div class='flex-shrink-0 p-2 bg-orange-500 rounded-lg'>
								<Icon name='simple-icons:substack' class='h-5 w-5 text-white' />
							</div>
							<span class='text-xs font-semibold text-orange-600 uppercase tracking-wider'>Newsletter</span>
						</div>
						<div class='text-left'>
							<p class='font-bold text-gray-900 text-base leading-tight'>Science of Marketing & Product Analytics</p>
							<p class='text-sm text-gray-600 leading-tight mt-0.5'>Subscribe to my newsletter</p>
						</div>
					</div>
					<div class='flex items-center gap-x-2 ml-4 flex-shrink-0'>
						<svg class='h-4 w-4 text-orange-600 transition-transform duration-200 group-hover:translate-x-1' fill='none' stroke='currentColor' viewBox='0 0 24 24'
							><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 5l7 7-7 7'></path></svg>
					</div>
				</a>

				<!-- Right Column: Two Stacked Utilities -->
				<div class='flex flex-col md:border-l border-orange-200'>
					<!-- Top: A/B Simulator -->
					<a
						href='/projects/ab-test-simulator'
						class='flex items-center justify-between rounded-xl md:rounded-none md:rounded-tr-xl bg-primary-foreground border border-border md:border-l-0 md:border-b md:border-t-0 px-6 py-4 transition-all duration-200 hover:bg-input hover:border-foreground/50 hover:shadow-sm group'
					>
						<div class='flex items-center gap-x-3'>
							<div class='flex-shrink-0 p-2 bg-blue-500 rounded-lg'>
								<Icon name='simple-icons:flask' class='h-5 w-5 text-white' />
							</div>
							<div class='text-left'>
								<p class='font-semibold text-foreground text-sm'>A/B Test Simulator</p>
								<p class='text-xs text-muted-foreground'>Interactive experiments</p>
							</div>
						</div>
						<svg class='h-4 w-4 text-muted-foreground transition-transform duration-200 group-hover:translate-x-1' fill='none' stroke='currentColor' viewBox='0 0 24 24'
							><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 5l7 7-7 7'></path></svg>
					</a>

					<!-- Bottom: Browse Projects -->
					<a
						href='/projects'
						class='flex items-center justify-between rounded-xl md:rounded-none md:rounded-br-xl bg-primary-foreground border border-border md:border-l-0 md:border-t-0 px-6 py-4 transition-all duration-200 hover:bg-input hover:border-foreground/50 hover:shadow-sm group'
					>
						<div class='flex items-center gap-x-3'>
							<div class='flex-shrink-0 p-2 bg-purple-500 rounded-lg'>
								<Icon name='simple-icons:github' class='h-5 w-5 text-white' />
							</div>
							<div class='text-left'>
								<p class='font-semibold text-foreground text-sm'>Browse Projects</p>
								<p class='text-xs text-muted-foreground'>See what I've built</p>
							</div>
						</div>
						<svg class='h-4 w-4 text-muted-foreground transition-transform duration-200 group-hover:translate-x-1' fill='none' stroke='currentColor' viewBox='0 0 24 24'
							><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 5l7 7-7 7'></path></svg>
					</a>
				</div>
			</div>
		</section>

		<!-- Recent Post Section -->
		{
			recentPost ? (
				<section class='flex flex-col gap-y-4'>
					<h2 class='text-2xl font-bold'>Latest Post</h2>
					<a href={`/blog/${recentPost.slug}`} class='group'>
						<div class='rounded-lg border border-border bg-primary-foreground p-4 transition-all hover:border-foreground/50 hover:shadow-sm'>
							<h3 class='text-lg font-semibold group-hover:text-foreground/75'>{recentPost.data.title}</h3>
							<p class='mt-2 text-sm text-muted-foreground'>{recentPost.data.description}</p>
							<div class='mt-3 flex items-center justify-between'>
								<FormattedDate date={recentPost.data.publishDate} />
							</div>
						</div>
					</a>
				</section>
			) : null
		}

		<!-- Tags Section -->
		{
			tags.length > 0 ? (
				<section class='flex flex-col gap-y-4'>
					<h2 class='text-2xl font-bold'>Explore by Topic</h2>
					<div class='flex flex-wrap gap-2'>
						{tags.map(([tag, count]) => (
							<a
								href={`/tags/${tag}`}
								class='rounded-lg border border-border bg-primary-foreground px-3 py-1.5 text-sm transition-all hover:bg-input hover:border-foreground/50'
							>
								<span class='font-medium'>#{tag}</span>
								<span class='ml-1 text-xs text-muted-foreground'>({count})</span>
							</a>
						))}
					</div>
				</section>
			) : null
		}
	</div>
</PageLayout>
