---
import BaseLayout from '@/layouts/BaseLayout.astro'
import Breadcrumbs from '../../../packages/shared/src/components/Breadcrumbs.astro'
import Contributors from '@/components/Contributors.astro'
import { parseProjectsYaml, getLiveProjects, getProjectsByStatus, STATUS_CONFIG } from '../../../packages/shared/src/lib/projects'

// @ts-ignore - yaml import
import projectsYaml from '../../../packages/shared/src/data/projects.yaml?raw'

const allProjects = parseProjectsYaml(projectsYaml)
const liveProjects = getLiveProjects(allProjects)
const inProgressProjects = getProjectsByStatus(allProjects, 'in-progress')
---

<BaseLayout meta={{ title: 'Build With Me' }}>
  <div class="flex w-full flex-col gap-y-6">
    <Breadcrumbs currentLabel="Contribute" />

    <!-- Hero -->
    <section class="mt-4">
      <h1 class="text-3xl font-bold font-serif">Build With Me</h1>
      <p class="mt-2 text-lg text-muted-foreground">
        I'm building data science tools in public. Each project is a standalone web app with real analytics. Contribute to existing projects or build your own.
      </p>
    </section>

    <!-- Contributors -->
    <section class="rounded-lg border border-border bg-card p-6">
      <h2 class="text-lg font-semibold mb-4">Recent Contributors</h2>
      <Contributors days={90} maxDisplay={8} />
    </section>

    <!-- Current Projects -->
    <section>
      <h2 class="text-xl font-semibold mb-4">Current Projects</h2>
      <p class="text-sm text-muted-foreground mb-4">
        Each <code class="bg-muted px-1.5 py-0.5 rounded text-xs">/packages/*</code> folder is an independent web app with its own analytics pipeline.
      </p>
      
      <div class="space-y-3">
        {liveProjects.map((project) => (
          <div class="flex items-center justify-between rounded-lg border border-border p-4">
            <div>
              <div class="flex items-center gap-2">
                <span class={`w-2 h-2 rounded-full ${STATUS_CONFIG[project.status].color}`}></span>
                <span class="font-medium">{project.name}</span>
              </div>
              <p class="text-sm text-muted-foreground mt-1">{project.shortDescription}</p>
            </div>
            <div class="flex gap-3 text-sm">
              {project.url && project.url !== '#' && (
                <a href={project.url} class="text-accent hover:underline">Try it ‚Üí</a>
              )}
              {project.hubUrl && (
                <a href={project.hubUrl} class="text-muted-foreground hover:text-accent hover:underline">Docs</a>
              )}
            </div>
          </div>
        ))}
        {inProgressProjects.map((project) => (
          <div class="flex items-center justify-between rounded-lg border border-border p-4 opacity-75">
            <div>
              <div class="flex items-center gap-2">
                <span class={`w-2 h-2 rounded-full ${STATUS_CONFIG[project.status].color}`}></span>
                <span class="font-medium">{project.name}</span>
                <span class="text-xs text-muted-foreground">({STATUS_CONFIG[project.status].label})</span>
              </div>
              <p class="text-sm text-muted-foreground mt-1">{project.shortDescription}</p>
            </div>
          </div>
        ))}
      </div>
    </section>

    <!-- How to Contribute -->
    <section>
      <h2 class="text-xl font-semibold mb-4">How to Contribute</h2>
      
      <h3 class="font-medium mb-2">Option 1: Fix or Enhance Existing</h3>
      <ol class="list-decimal list-inside space-y-1 text-sm mb-4">
        <li><strong>Browse</strong> <a href="https://github.com/eeshansrivastava89/ds-apps-main/issues?q=is%3Aissue+is%3Aopen" class="text-accent hover:underline">open issues</a></li>
        <li><strong>Claim</strong> by commenting on an issue</li>
        <li><strong>Branch</strong> as <code class="bg-muted px-1.5 py-0.5 rounded text-xs">feature/your-handle-topic</code></li>
        <li><strong>Ship</strong> a PR with summary + screenshots</li>
      </ol>
      <p class="text-sm mb-6">
        <a href="https://github.com/eeshansrivastava89/ds-apps-main/issues?q=is%3Aissue+is%3Aopen+label%3A%22good+first+issue%22" class="text-accent hover:underline">Good First Issues ‚Üí</a>
        <span class="mx-2 text-muted-foreground">¬∑</span>
        <a href="https://github.com/eeshansrivastava89/ds-apps-main" class="text-muted-foreground hover:text-accent hover:underline">Source Code</a>
      </p>

      <h3 class="font-medium mb-2">Option 2: Build a New Web App</h3>
      <ol class="list-decimal list-inside space-y-1 text-sm mb-2">
        <li><strong>Propose</strong> via <a href="https://github.com/eeshansrivastava89/ds-apps-main/discussions/new?category=new-data-science-web-app-proposals" class="text-accent hover:underline">GitHub Discussion</a></li>
        <li><strong>Get approved</strong> ‚Äî we'll discuss scope and infrastructure</li>
        <li><strong>Build</strong> in <code class="bg-muted px-1.5 py-0.5 rounded text-xs">/packages/your-app</code></li>
        <li><strong>Analyze</strong> ‚Äî add a notebook, we'll auto-render it</li>
      </ol>
      <p class="text-sm text-muted-foreground">
        You get: PostHog analytics (shared), Supabase schema template, auto-running notebooks, your name on the project.
      </p>
    </section>

    <!-- Advice -->
    <section>
      <h2 class="text-xl font-semibold mb-4">Full Stack DS Advice</h2>
      <ul class="space-y-2 text-sm">
        <li><strong>Use AI comprehensively</strong> ‚Äî explain codebase context, review approach, iterate</li>
        <li><strong>Follow the workflow</strong> ‚Äî <a href="/writing/how-i-ai" class="text-accent hover:underline">How I AI</a> breaks down my approach</li>
        <li><strong>Test before PR</strong> ‚Äî <code class="bg-muted px-1 py-0.5 rounded text-xs">pnpm dev</code> ‚Üí <code class="bg-muted px-1 py-0.5 rounded text-xs">pnpm build</code> ‚Üí ship</li>
      </ul>
    </section>

    <!-- Follow -->
    <section>
      <h2 class="text-xl font-semibold mb-4">Follow the Build</h2>
      <div class="flex flex-wrap gap-4 text-sm">
        <a href="https://eeshansrivastava.substack.com/" class="text-accent hover:underline">üìß Substack</a>
        <a href="https://twitter.com/eeshan_s" class="text-accent hover:underline">ùïè Twitter</a>
        <a href="/rss.xml" class="text-accent hover:underline">üì° RSS</a>
        <a href="https://github.com/eeshansrivastava89/ds-apps-main" class="text-accent hover:underline">GitHub</a>
      </div>
    </section>

    <!-- Stack -->
    <p class="text-sm text-muted-foreground border-t border-border pt-4">
      <strong>Stack:</strong> Astro ¬∑ React ¬∑ Tailwind ¬∑ PostHog ¬∑ Supabase ¬∑ Python
    </p>

  </div>
</BaseLayout>
