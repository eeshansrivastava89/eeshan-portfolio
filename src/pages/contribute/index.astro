---
import BaseLayout from '@/layouts/BaseLayout.astro'
import Breadcrumbs from '../../../packages/shared/src/components/Breadcrumbs.astro'
import Contributors from '@/components/Contributors.astro'
import { Icon } from 'astro-icon/components'
---

<BaseLayout meta={{ title: 'Contribute' }}>
  <div class="flex w-full flex-col">
    <Breadcrumbs currentLabel="Contribute" />

    <!-- Hero -->
    <section class="mt-6 mb-8">
      <h1 class="text-2xl font-bold text-foreground sm:text-3xl">Contribute</h1>
      <p class="mt-2 text-base text-muted-foreground">
        I like to document everything — I use GitHub issues to track even my own solo work. I've also set up a full workflow for fixing issues or adding new apps, so if you're interested in contributing, jump in. This process is brand new, so reach out if you hit any snags.
      </p>
    </section>

    <!-- Recent Contributors -->
    <section class="mb-8 border border-border bg-primary-foreground p-6">
      <h2 class="text-lg font-bold text-foreground mb-4">Recent Contributors</h2>
      <Contributors days={90} maxDisplay={8} />
    </section>

    <!-- Two Column: Options -->
    <div class="grid gap-6 lg:grid-cols-2 mb-8">
      
      <!-- Option 1: Fix Existing -->
      <div class="border border-border bg-primary-foreground p-6">
        <h2 class="text-lg font-bold text-foreground mb-3">Option 1: Fix or Enhance</h2>
        <ul class="space-y-2 text-base text-muted-foreground">
          <li>Browse <a href="https://github.com/eeshansrivastava89/ds-apps-main/issues?q=is%3Aissue+is%3Aopen" class="underline hover:text-foreground">open issues</a></li>
          <li>Claim by commenting "I'll work on this"</li>
          <li>Branch, fix, test, submit PR</li>
        </ul>
      </div>

      <!-- Option 2: Build New -->
      <div class="border border-border bg-primary-foreground p-6">
        <h2 class="text-lg font-bold text-foreground mb-3">Option 2: Build New App</h2>
        <ul class="space-y-2 text-base text-muted-foreground">
          <li>Propose via <a href="https://github.com/eeshansrivastava89/ds-apps-main/discussions/new?category=new-data-science-web-app-proposals" class="underline hover:text-foreground">GitHub Discussion</a></li>
          <li>Run <code class="bg-muted px-1.5 py-0.5 rounded text-sm">node scripts/create-package.mjs</code></li>
          <li>Build, analyze, ship</li>
        </ul>
      </div>

    </div>

    <!-- Prerequisites -->
    <section class="mb-8 border border-border bg-primary-foreground p-6">
      <h2 class="text-lg font-bold text-foreground mb-4">Prerequisites</h2>
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-border">
              <th class="text-left py-2 px-3 font-medium">Tool</th>
              <th class="text-left py-2 px-3 font-medium">Check</th>
              <th class="text-left py-2 px-3 font-medium">Install</th>
            </tr>
          </thead>
          <tbody>
            <tr class="border-b border-border">
              <td class="py-2 px-3">Node.js 20+</td>
              <td class="py-2 px-3"><code class="bg-muted px-1.5 py-0.5 rounded">node -v</code></td>
              <td class="py-2 px-3"><a href="https://nodejs.org/" class="underline hover:text-foreground">nodejs.org</a></td>
            </tr>
            <tr class="border-b border-border">
              <td class="py-2 px-3">pnpm 9+</td>
              <td class="py-2 px-3"><code class="bg-muted px-1.5 py-0.5 rounded">pnpm -v</code></td>
              <td class="py-2 px-3"><code class="bg-muted px-1.5 py-0.5 rounded">npm i -g pnpm</code></td>
            </tr>
            <tr class="border-b border-border">
              <td class="py-2 px-3">Git + GitHub CLI</td>
              <td class="py-2 px-3"><code class="bg-muted px-1.5 py-0.5 rounded">gh --version</code></td>
              <td class="py-2 px-3"><a href="https://cli.github.com/" class="underline hover:text-foreground">cli.github.com</a></td>
            </tr>
            <tr class="border-b border-border">
              <td class="py-2 px-3">Python 3.11+ (notebooks)</td>
              <td class="py-2 px-3"><code class="bg-muted px-1.5 py-0.5 rounded">python --version</code></td>
              <td class="py-2 px-3"><a href="https://python.org/" class="underline hover:text-foreground">python.org</a></td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Stack -->
    <section id="stack" class="mb-8 border border-border bg-primary-foreground p-6">
      <h2 class="text-lg font-bold text-foreground mb-4">Stack</h2>
      <div class="space-y-4">
        <div>
          <h3 class="text-sm font-medium text-muted-foreground mb-2">Frontend</h3>
          <div class="flex flex-wrap items-center gap-x-2 text-base">
            <a href="https://astro.build/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:astro" class="h-4 w-4" /> Astro
            </a>
            <span class="text-muted-foreground">|</span>
            <a href="https://react.dev/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:react" class="h-4 w-4" /> React
            </a>
            <span class="text-muted-foreground">|</span>
            <a href="https://tailwindcss.com/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:tailwindcss" class="h-4 w-4" /> Tailwind
            </a>
          </div>
        </div>
        <div>
          <h3 class="text-sm font-medium text-muted-foreground mb-2">Backend</h3>
          <div class="flex flex-wrap items-center gap-x-2 text-base">
            <a href="https://supabase.com/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:supabase" class="h-4 w-4" /> Supabase
            </a>
            <span class="text-muted-foreground">|</span>
            <a href="https://posthog.com/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:posthog" class="h-4 w-4" /> PostHog
            </a>
          </div>
        </div>
        <div>
          <h3 class="text-sm font-medium text-muted-foreground mb-2">Infrastructure</h3>
          <div class="flex flex-wrap items-center gap-x-2 text-base">
            <a href="https://fly.io/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:flydotio" class="h-4 w-4" /> Fly.io
            </a>
            <span class="text-muted-foreground">|</span>
            <a href="https://github.com/features/actions" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:githubactions" class="h-4 w-4" /> Actions
            </a>
            <span class="text-muted-foreground">|</span>
            <a href="https://cloudflare.com/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:cloudflare" class="h-4 w-4" /> Cloudflare
            </a>
            <span class="text-muted-foreground">|</span>
            <a href="https://papermill.readthedocs.io/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:jupyter" class="h-4 w-4" /> Papermill
            </a>
          </div>
        </div>
        <div>
          <h3 class="text-sm font-medium text-muted-foreground mb-2">Data Science</h3>
          <div class="flex flex-wrap items-center gap-x-2 text-base">
            <a href="https://python.org/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:python" class="h-4 w-4" /> Python
            </a>
            <span class="text-muted-foreground">|</span>
            <a href="https://pandas.pydata.org/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:pandas" class="h-4 w-4" /> Pandas
            </a>
            <span class="text-muted-foreground">|</span>
            <a href="https://plotly.com/python/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:plotly" class="h-4 w-4" /> Plotly
            </a>
            <span class="text-muted-foreground">|</span>
            <a href="https://www.statsmodels.org/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:scipy" class="h-4 w-4" /> Statsmodels
            </a>
            <span class="text-muted-foreground">|</span>
            <a href="https://seaborn.pydata.org/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:python" class="h-4 w-4" /> Seaborn
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- Environment / Analytics -->
    <section class="mb-8 border border-border bg-primary-foreground p-6">
      <h2 class="text-lg font-bold text-foreground mb-4">Environment Setup</h2>
      <div class="space-y-4 text-base text-muted-foreground">
        <div>
          <h3 class="font-medium text-foreground mb-2">Quick Start</h3>
          <p>Copy the example env file — it includes shared project keys:</p>
          <pre class="mt-2 bg-zinc-900 text-zinc-100 p-3 rounded text-sm overflow-x-auto"><code>cp .env.example .env</code></pre>
        </div>
        <div>
          <h3 class="font-medium text-foreground mb-2">What You Get</h3>
          <ul class="mt-2 space-y-1 list-disc list-inside">
            <li><strong>Supabase</strong> — Query production data in notebooks (read-only via RLS)</li>
            <li><strong>PostHog</strong> — Track events locally to the shared project</li>
          </ul>
          <p class="mt-2 text-sm text-muted-foreground">
            Keys are public by design. Row Level Security prevents modifications to production data.
          </p>
          <p class="mt-2 text-sm text-muted-foreground">
            <strong>Need new tables or custom tracking?</strong> Open a PR with a migration file or reach out to the maintainer.
          </p>
        </div>
      </div>
    </section>

    <!-- Notebooks -->
    <section class="mb-8 border border-border bg-primary-foreground p-6">
      <h2 class="text-lg font-bold text-foreground mb-4">Adding Notebooks</h2>
      <div class="space-y-4 text-base text-muted-foreground">
        <p>Each app can have Jupyter notebooks that run weekly and output to the public analysis folder.</p>
        
        <div>
          <h3 class="font-medium text-foreground mb-2">Folder Structure</h3>
          <pre class="bg-zinc-900 text-zinc-100 p-3 rounded text-sm overflow-x-auto"><code>analytics/notebooks/your-app-id/
├── analysis.ipynb        → public/analysis/your-app-id/
├── dashboard.ipynb       → public/analysis/your-app-id-dashboard/
└── requirements.txt      (optional, app-specific deps)</code></pre>
        </div>

        <div>
          <h3 class="font-medium text-foreground mb-2">How It Works</h3>
          <ul class="space-y-1 list-disc list-inside">
            <li>Drop <code class="bg-muted px-1.5 py-0.5 rounded text-sm">.ipynb</code> files in <code class="bg-muted px-1.5 py-0.5 rounded text-sm">analytics/notebooks/your-app-id/</code></li>
            <li>GitHub Action runs weekly (and on push to <code class="bg-muted px-1.5 py-0.5 rounded text-sm">analytics/notebooks/**</code>)</li>
            <li>Outputs go to <code class="bg-muted px-1.5 py-0.5 rounded text-sm">public/analysis/</code> — auto-committed</li>
          </ul>
        </div>

        <div>
          <h3 class="font-medium text-foreground mb-2">No Setup Required</h3>
          <p>The workflow runs automatically in the main repo. Contributors don't need to configure GitHub Actions — just add notebooks and PR them in.</p>
        </div>
      </div>
    </section>

    <!-- Workflow Diagram -->
    <section class="mb-8 border border-border bg-white dark:bg-zinc-900 p-6 rounded-lg">
      <h2 class="text-lg font-bold text-foreground mb-4">Workflow Overview</h2>
      <div class="mermaid-container overflow-x-auto" style="min-height: 500px;">
        <pre class="mermaid mx-auto" style="display: flex; justify-content: center;">
flowchart TB
    subgraph SETUP["SETUP"]
        A[Fork repo on GitHub] --> B[git clone]
        B --> C[pnpm install]
        C --> D[pnpm dev]
    end

    D --> E[[Choose Path]]

    subgraph FIX["OPTION 1: Fix Existing"]
        F[Find issue] --> G[Claim it]
        G --> H[Make changes]
    end

    subgraph BUILD["OPTION 2: Build New App"]
        I[Propose in Discussion] --> J[create-package.mjs]
        J --> K[Build your app]
    end

    E -->|Quick fix| F
    E -->|New project| I
    
    H --> L[pnpm build]
    K --> L

    subgraph SUBMIT["SUBMIT"]
        L --> M[git push]
        M --> N[gh pr create]
    end

    subgraph REVIEW["REVIEW by Maintainer"]
        N --> O[Review and Test]
        O --> P[gh pr merge --squash]
    end

    subgraph SYNC["SYNC"]
        P --> Q[gh repo sync]
        Q --> R[git pull]
    end

    style SETUP fill:#f1f5f9,stroke:#cbd5e1
    style FIX fill:#dcfce7,stroke:#86efac
    style BUILD fill:#fef3c7,stroke:#fcd34d
    style SUBMIT fill:#dbeafe,stroke:#93c5fd
    style REVIEW fill:#e0e7ff,stroke:#a5b4fc
    style SYNC fill:#f3e8ff,stroke:#d8b4fe
        </pre>
      </div>
      <p class="mt-4 text-sm text-muted-foreground text-center">
        Both paths converge at Submit → Review → Sync
      </p>
    </section>

  </div>
</BaseLayout>

<style>
  pre.mermaid {
    @apply bg-transparent border-0 p-0;
  }
  .mermaid svg {
    margin: 0 auto;
  }
</style>

<!-- Mermaid for diagrams -->
<script is:inline src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script is:inline>
  mermaid.initialize({ 
    startOnLoad: true,
    theme: 'neutral'
  });
</script>
