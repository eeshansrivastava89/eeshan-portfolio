---
import BaseLayout from '@/layouts/BaseLayout.astro'
import BuildLogView from '@/components/contribute/BuildLogView'
import VideoModal from '@/components/contribute/VideoModal'
import { validateBuildLogData } from '@/lib/build-log-types'

import buildLogDataRaw from '@/data/build-log-data.json'

const buildLogData = validateBuildLogData(buildLogDataRaw)
if (!buildLogData) throw new Error('Invalid build-log-data.json')

const { tasks, contributors, recentActivity } = buildLogData

const mergedCount = tasks.filter(t => t.status === 'merged').length
const openCount = tasks.filter(t => t.status === 'open').length
---

<BaseLayout meta={{ title: 'Contribute' }}>
  <div class='w-full space-y-12'>
    <!-- HERO -->
    <section class='space-y-4'>
      <a href='/' class='inline-flex items-center gap-1 text-sm text-muted-foreground hover:text-foreground transition'>← Back to Home</a>

      <div class='flex flex-col gap-8 lg:flex-row lg:items-start lg:justify-between'>
        <div class='space-y-4'>
          <h1 class='text-2xl font-bold text-foreground sm:text-4xl'>Ship With Me</h1>
          <p class='max-w-2xl text-base text-muted-foreground'>Claim a task, open a PR, get code review, and ship. Real projects, real GitHub history.</p>

          <div class='flex flex-wrap items-center gap-6 text-sm'>
            <div class='flex items-center gap-1.5'>
              <span class='text-2xl font-bold text-foreground'>{openCount}</span>
              <span class='text-muted-foreground'>open</span>
            </div>
            <div class='flex items-center gap-1.5'>
              <span class='text-2xl font-bold text-emerald-600'>{mergedCount}</span>
              <span class='text-muted-foreground'>shipped</span>
            </div>
          </div>
        </div>

        <!-- Video CTA - inline with hero -->
        <div class='w-full max-w-xs shrink-0'>
          <VideoModal client:load />
        </div>
      </div>
    </section>

    <!-- Tasks & Contributors -->
    <BuildLogView tasks={tasks} contributors={contributors} recentActivity={recentActivity} client:load />

    <!-- How to Ship -->
    <section class='space-y-4'>
      <h2 class='text-xl font-semibold text-foreground'>How to Ship</h2>
      <ol class='list-decimal space-y-3 pl-5 text-sm text-muted-foreground'>
        <li><span class='font-semibold text-foreground'>Claim the issue:</span> comment on GitHub to reserve your slot; unclaimed issues are fair game.</li>
        <li><span class='font-semibold text-foreground'>Branch naming:</span> <code class='bg-slate-200 dark:bg-slate-800 text-slate-800 dark:text-slate-200 px-2 py-1 text-[11px]'>feature/your-handle-topic</code>.</li>
        <li><span class='font-semibold text-foreground'>Setup env:</span> add PostHog + Supabase keys; run <code class='bg-slate-200 dark:bg-slate-800 text-slate-800 dark:text-slate-200 px-2 py-1 text-[11px]'>pnpm dev</code>.</li>
        <li><span class='font-semibold text-foreground'>Validate:</span> play the flow, keep console clean, lint if you touch TS/JS.</li>
        <li><span class='font-semibold text-foreground'>PR template:</span> include summary, screenshots/gifs for UI, checklist for tracking changes.</li>
        <li><span class='font-semibold text-foreground'>Optional:</span> add a 30–60s Loom demo for reviewers.</li>
      </ol>
    </section>

    <!-- FAQ -->
    <section class='space-y-4'>
      <h2 class='text-xl font-semibold text-foreground'>FAQ</h2>
      <ul class='space-y-2 text-sm text-muted-foreground'>
        <li><span class='font-semibold text-foreground'>Non-commercial:</span> personal educational project.</li>
        <li><span class='font-semibold text-foreground'>Time:</span> issues marked for scope; async friendly.</li>
        <li><span class='font-semibold text-foreground'>Stack:</span> Astro, Tailwind, PostHog, Supabase/PostgREST, Plotly.</li>
        <li><span class='font-semibold text-foreground'>Taken issue?</span> pick another or waitlist in comments.</li>
      </ul>
    </section>
  </div>
</BaseLayout>
