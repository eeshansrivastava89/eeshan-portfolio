---
/**
 * Work Experience Cards (Collapsible)
 * Card-based accordion using native <details>
 */
import { Icon } from 'astro-icon/components'

interface TimelineItem {
  timespan: string
  title: string
  company?: string
  description?: string
  logo?: string
  details?: string[]
  type?: 'education' | 'work'
}

interface Props {
  items: TimelineItem[]
}

const { items } = Astro.props

const getIcon = (item: TimelineItem) => item.type === 'education' ? 'lucide:graduation-cap' : 'lucide:briefcase'
const getAccent = (item: TimelineItem, isCurrent: boolean) => {
  if (isCurrent) return 'text-emerald-600 dark:text-emerald-400'
  if (item.type === 'education') return 'text-sky-600 dark:text-sky-400'
  return 'text-muted-foreground'
}
---

<div class='space-y-3'>
  {items.map((item, index) => {
    const isCurrent = item.timespan.includes('Present')
    const hasContent = item.description || (item.details && item.details.length > 0)
    const accent = getAccent(item, isCurrent)
    
    return (
      <div class='rounded-lg border border-border bg-card transition-shadow hover:shadow-md'>
        {hasContent ? (
          <details class='group' open={isCurrent}>
            <summary class='flex cursor-pointer list-none items-center gap-4 p-4 [&::-webkit-details-marker]:hidden'>
              {/* Icon */}
              <div class='flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-muted'>
                <Icon name={getIcon(item)} class='h-5 w-5 text-muted-foreground' />
              </div>
              
              {/* Title & Company */}
              <div class='flex-1 min-w-0'>
                <h4 class='text-lg font-semibold text-foreground'>{item.title}</h4>
                <p class='text-base text-muted-foreground'>{item.company}</p>
              </div>

              {/* Date & Chevron */}
              <div class='flex items-center gap-3 shrink-0'>
                <span class={`text-base font-medium ${accent}`}>{item.timespan}</span>
                <Icon 
                  name='lucide:chevron-down' 
                  class='h-5 w-5 text-muted-foreground transition-transform duration-200 group-open:rotate-180' 
                />
              </div>
            </summary>
            
            {/* Expanded Content */}
            <div class='border-t border-border px-4 pb-4 pt-3'>
              {item.description && (
                <p class='text-base text-muted-foreground'>{item.description}</p>
              )}
              {item.details && item.details.length > 0 && (
                <ul class='mt-3 space-y-1.5'>
                  {item.details.map((detail, i) => (
                    <li class='flex items-start gap-3 text-base text-muted-foreground'>
                      <span class='flex h-5 w-5 shrink-0 items-center justify-center rounded bg-muted text-xs font-medium'>{i + 1}</span>
                      <span>{detail}</span>
                    </li>
                  ))}
                </ul>
              )}
            </div>
          </details>
        ) : (
          /* Non-expandable card */
          <div class='flex items-center gap-4 p-4'>
            <div class='flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-muted'>
              <Icon name={getIcon(item)} class='h-5 w-5 text-muted-foreground' />
            </div>
            <div class='flex-1 min-w-0'>
              <h4 class='text-lg font-semibold text-foreground'>{item.title}</h4>
              <p class='text-base text-muted-foreground'>{item.company}</p>
            </div>
            <span class={`text-base font-medium shrink-0 ${accent}`}>{item.timespan}</span>
          </div>
        )}
      </div>
    )
  })}
</div>
