---
import type { HTMLTag, Polymorphic } from 'astro/types'
import type { SubstackPost } from '../lib/substack'

type Props<Tag extends HTMLTag> = Polymorphic<{ as: Tag }> & {
	post: SubstackPost
	withDesc?: boolean
}

const { as: Tag = 'div', post, withDesc = false } = Astro.props

// Format date inline
const formattedDate = post.pubDate.toLocaleDateString('en-US', {
	month: 'short',
	day: 'numeric',
	year: 'numeric'
})
---

<li class='flex flex-col gap-2 sm:flex-row sm:gap-x-4 [&_q]:basis-full'>
	<div class='flex min-w-[120px] items-center gap-2 sm:block'>
		<time datetime={post.pubDate.toISOString()}>{formattedDate}</time>
	</div>

	<Tag class='flex-1'>
		<a
			href={post.link}
			target="_blank"
			rel="noopener noreferrer"
			class='transition-all hover:text-muted-foreground inline-flex items-center gap-2'
		>
			{post.title}
			<span class="inline-flex items-center gap-1 px-1.5 py-0.5 text-[10px] font-medium bg-[#FF6719]/10 text-[#FF6719] rounded">
				<svg class="h-2.5 w-2.5" viewBox="0 0 24 24" fill="currentColor">
					<path d="M22.539 8.242H1.46V5.406h21.08v2.836zM1.46 10.812V24L12 18.11 22.54 24V10.812H1.46zM22.54 0H1.46v2.836h21.08V0z"/>
				</svg>
				Substack
			</span>
		</a>
		{
			withDesc && (
				<p class='line-clamp-3 block text-sm italic text-muted-foreground'>
					{post.description}
				</p>
			)
		}
	</Tag>
</li>
