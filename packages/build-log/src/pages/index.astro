---
import SiteLayout from '../../../shared/src/layouts/SiteLayout.astro'
import VideoModal from '../components/VideoModal'
import LearningsTimeline from '../components/LearningsTimeline'
import { validateBuildLogData } from '../lib/validate-build-log'
import { parseLearningsYaml, getLearnings } from '../../../shared/src/lib/learnings'

// Import YAML as raw string (Vite handles this)
import learningsYaml from '../../../shared/src/data/learnings.yaml?raw'

// Data source (overwritten by fetch script). Keep defaults for local preview.
import buildLogData from '../data/build-log-data.json'

const validatedData = validateBuildLogData(buildLogData)
if (!validatedData) {
	throw new Error('Invalid build-log-data.json. Run: npm run fetch:data')
}

const { tasks, contributors } = validatedData

// Load learnings from YAML
const allLearnings = getLearnings(parseLearningsYaml(learningsYaml))

// Compute stats for contribute CTA
const totalContributors = contributors.length
const openCount = tasks.filter(t => t.status === 'open').length
---

<SiteLayout meta={{ title: 'The Build Log' }}>
	<div class='w-full space-y-12'>

		<!-- ============================================ -->
		<!-- HERO: Solo-first messaging                   -->
		<!-- ============================================ -->
		<section class='space-y-4'>
			<p class='text-xs font-semibold uppercase tracking-[0.3em] text-primary'>The Build Log</p>
			
			<div class='grid gap-6 lg:grid-cols-[1fr_320px]'>
				<div class='space-y-4'>
					<h1 class='text-2xl font-bold text-foreground sm:text-4xl'>Learning AI-native data science by building products</h1>
					<p class='max-w-2xl text-base text-muted-foreground'>
						I'm building full-stack products with AI tools, then doing data science on real user data. Everything is open: the code, the decisions, the mistakes.
					</p>
					
					<!-- CTAs -->
					<div class='flex flex-wrap gap-3'>
						<a
							href='#projects'
							class='inline-flex items-center gap-2 rounded-full bg-orange-500 px-5 py-2.5 text-sm font-semibold text-white shadow-sm transition hover:-translate-y-0.5 hover:bg-orange-400'
						>
							See Current Project
						</a>
						<a
							href='/build-log/contribute/'
							class='inline-flex items-center gap-2 rounded-full border border-border bg-primary-foreground px-5 py-2.5 text-sm font-medium text-foreground transition hover:-translate-y-0.5 hover:border-foreground/30'
						>
							Want to Contribute?
						</a>
					</div>
				</div>

				<!-- Video thumbnail -->
				<div class='hidden lg:block'>
					<VideoModal client:load />
				</div>
			</div>
		</section>

		<!-- ============================================ -->
		<!-- 80% SECTION: What I'm Building               -->
		<!-- ============================================ -->
		<section id='projects' class='space-y-6'>
			<div>
				<h2 class='text-2xl font-bold text-foreground'>What I'm Building</h2>
				<p class='mt-1 text-sm text-muted-foreground'>Live projects with real users and real data.</p>
			</div>

			<!-- A/B Simulator Card -->
			<div class='rounded-2xl border border-border bg-primary-foreground p-6 shadow-lg shadow-black/5 transition hover:-translate-y-0.5 hover:border-orange-300 hover:shadow-xl'>
				<div class='flex flex-wrap items-start justify-between gap-4'>
					<div class='space-y-3'>
						<div class='flex items-center gap-3'>
							<h3 class='text-xl font-semibold text-foreground'>A/B Test Simulator</h3>
							<span class='inline-flex items-center gap-1 rounded-full bg-emerald-100 dark:bg-emerald-500/20 px-2.5 py-1 text-xs font-semibold text-emerald-700 dark:text-emerald-300'>
								<span class='h-1.5 w-1.5 rounded-full bg-emerald-500'></span>
								Live
							</span>
						</div>
						<p class='max-w-xl text-sm text-muted-foreground'>
							Interactive tool for learning A/B testing fundamentals. Run experiments, visualize statistical significance, and understand the math behind the scenes.
						</p>
						<div class='flex flex-wrap gap-2'>
							<span class='rounded-full bg-orange-100 dark:bg-orange-500/20 px-2.5 py-1 text-xs font-medium text-orange-700 dark:text-orange-300'>Astro</span>
							<span class='rounded-full bg-sky-100 dark:bg-sky-500/20 px-2.5 py-1 text-xs font-medium text-sky-700 dark:text-sky-300'>React</span>
							<span class='rounded-full bg-cyan-100 dark:bg-cyan-500/20 px-2.5 py-1 text-xs font-medium text-cyan-700 dark:text-cyan-300'>Tailwind</span>
							<span class='rounded-full bg-violet-100 dark:bg-violet-500/20 px-2.5 py-1 text-xs font-medium text-violet-700 dark:text-violet-300'>Plotly</span>
						</div>
					</div>
					<a
						href='/ab-simulator/'
						class='inline-flex items-center gap-2 rounded-full bg-orange-500 px-5 py-2.5 text-sm font-semibold text-white shadow-sm transition hover:-translate-y-0.5 hover:bg-orange-400'
					>
						Try It →
					</a>
				</div>
			</div>
		</section>

		<!-- ============================================ -->
		<!-- 80% SECTION: What I've Learned               -->
		<!-- ============================================ -->
		<section id='learnings' class='space-y-6'>
			<div>
				<h2 class='text-2xl font-bold text-foreground'>What I've Learned</h2>
				<p class='mt-1 text-sm text-muted-foreground'>Build logs, technical deep-dives, and lessons from shipping.</p>
			</div>

			<LearningsTimeline learnings={allLearnings} pageSize={10} client:load />
		</section>

		<!-- ============================================ -->
		<!-- 20% SECTION: Want to Contribute?             -->
		<!-- ============================================ -->
		<section id='contribute' class='border-t border-border pt-12'>
			<a 
				href='/build-log/contribute/' 
				class='group block rounded-2xl border border-border bg-primary-foreground p-6 shadow-lg shadow-black/5 transition hover:-translate-y-0.5 hover:border-orange-300 hover:shadow-xl'
			>
				<div class='flex flex-wrap items-center justify-between gap-4'>
					<div class='space-y-2'>
						<h2 class='text-xl font-semibold text-foreground group-hover:text-orange-500 transition'>Want to Contribute?</h2>
						<p class='text-sm text-muted-foreground'>
							Claim a task, open a PR, get code review, and ship. Real projects, real GitHub history.
						</p>
						<div class='flex items-center gap-4 text-sm'>
							<span><span class='font-bold text-foreground'>{totalContributors}</span> <span class='text-muted-foreground'>contributors</span></span>
							<span><span class='font-bold text-orange-500'>{openCount}</span> <span class='text-muted-foreground'>open tasks</span></span>
						</div>
					</div>
					<span class='inline-flex items-center gap-2 rounded-full bg-orange-500 px-5 py-2.5 text-sm font-semibold text-white shadow-sm transition group-hover:bg-orange-400'>
						See Open Tasks →
					</span>
				</div>
			</a>
		</section>
	</div>
</SiteLayout>


