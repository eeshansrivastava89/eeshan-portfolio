# Architecture V2: Site Simplification

> **Status:** Phase 1-5 Complete âœ… | Phase 13 Complete âœ… | Phase 14 Complete âœ… | Phase 15 Complete âœ… | Phase 16 Deferred â¸ï¸
> **Date:** December 2024
> **Goal:** Simplify UX by focusing the main site on **projects + unified analysis page**, moving writing to Substack.

---

## Why This Change?

After launching and watching real user behavior:

1. **Double-posting is unsustainable** â€” Writing on site + Substack = extra mental load
2. **No email capture on main site** â€” Substack has built-in audience + network effects
3. **Too many clicks** â€” Hub pages add friction between users and apps
4. **Contribute page is low-traffic** â€” GitHub CONTRIBUTING.md is the real source of truth

**New focus:** Main site = projects + unified analysis page (notebooks + posts). Writing = Substack (with links back).

---

## Site Structure: Before vs After

### Navigation

| Before | After |
|--------|-------|
| About \| Projects \| Writing \| Contribute \| ðŸŒ™ | About \| Projects \| Analysis \| Subscribe \| ðŸŒ™ |

### Routes

| Before | After | Notes |
|--------|-------|-------|
| `/` | `/` | Home (unchanged) |
| `/about` | `/about` | About (unchanged) |
| `/projects` | `/projects` | Projects index (unchanged) |
| `/projects/ab-simulator` | âŒ Removed | Hub pages retired |
| `/ab-simulator/` | `/ab-simulator/` | App page (restructured) |
| `/writing` | âŒ Removed | Redirects to Substack |
| `/contribute` | âŒ Removed | Link to GitHub instead |
| â€” | `/analysis` | **NEW:** Unified notebooks + posts (Linear-inspired) |
| `/projects/{id}/analysis/{notebookId}` | Keep | Notebook detail pages |

---

## App Page Structure (Restructured)

Each app page follows this three-section layout:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ App Header                                 (Templatized)    â”‚
â”‚ - Hero (title, description, status badge)                   â”‚
â”‚ - "Contribute on GitHub" button                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ App Functionality                          (Templatized)    â”‚
â”‚ - Unique per app (game, dashboard, charts)                  â”‚
â”‚ - Placeholder with instructions if empty:                   â”‚
â”‚   "Build your app here. See ab-simulator for example."      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Related Content                            (Templatized)    â”‚
â”‚                                                             â”‚
â”‚ ðŸ“Š Analysis Notebooks                                       â”‚
â”‚ - Auto-generated summaries from analytics/notebooks/        â”‚
â”‚ - NotebookSummary islands (methods, findings, conclusions)  â”‚
â”‚ - [View Full Notebook â†’] links                              â”‚
â”‚ - Placeholder if no notebooks exist                         â”‚
â”‚                                                             â”‚
â”‚ ðŸ“® Related Writing                                          â”‚
â”‚ - Substack posts tagged with this project                   â”‚
â”‚ - Post previews with excerpts                               â”‚
â”‚ - [Read on Substack â†’] links                                â”‚
â”‚ - Placeholder if no posts exist                             â”‚
â”‚                                                             â”‚
â”‚ [View All Notebooks & Posts â†’ /analysis?project=x]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Templatized sections** (auto-generated by `AppLayout`):
1. **App Header** â€” Hero, description, GitHub button
2. **App Functionality** â€” Slot with placeholder instructions
3. **Related Content** â€” Notebooks + posts with placeholders

**Unique per app:**
- App functionality implementation (game logic, dashboards, interactive UI)

---

## Data Flow

### Substack Posts (âœ… Implemented)

Substack RSS provides: `title`, `link`, `pubDate`, `description`. **No project tags.**

**Solution:** Manual YAML mapping in `packages/shared/src/data/substack-posts.yaml` for project association.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Substack RSS    â”‚â”€â”€â”€â”€â–¶â”‚ packages/shared/src/lib/substack.tsâ”‚
â”‚ (title, url,    â”‚     â”‚ (fetch + parse)                    â”‚
â”‚  date, excerpt) â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ substack-       â”‚â”€â”€â”€â”€â–¶â”‚ Join: RSS metadata + â”‚
â”‚ posts.yaml      â”‚     â”‚ project_id mapping   â”‚
â”‚ (urlâ†’project_id)â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
                                   â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ /analysis page       â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Content â†’ Analysis Page

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ analytics/notebooks/ â”‚â”€â”€â”€â”€â–¶â”‚ CI runs notebooks    â”‚
â”‚ (Jupyter .ipynb)     â”‚     â”‚ Outputs HTML + YAML  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Substack RSS         â”‚     â”‚ public/analysis/     â”‚
â”‚ (via substack.ts)    â”‚â”€â”€â”€â”€â–¶â”‚ (HTML + YAML)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚ Build-time aggregation
                                        â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Unified data structure       â”‚
                        â”‚ [{type, title, project,      â”‚
                        â”‚   date, methods, link}...]   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ /analysis (React island)     â”‚
                        â”‚ shadcn + TanStack Table      â”‚
                        â”‚ + bazza/ui DataTableFilter   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â–¼                    â–¼                    â–¼
        Group by Project     Filter by Type      Sort by Date
        (A/B Sim, etc.)    (Notebook, Post)    (Latest first)
```

**Extended YAML schema fields (for filtering):**
- `project_id` â€” Links content to project
- `methods` â€” Array of statistical methods (Bayesian, SQL, etc.)
- `tags` â€” Array of topic tags (ab-testing, statistics, etc.)
- `views` â€” View count (notebooks only)

**Tech stack:**
- **shadcn/ui** â€” UI components (Table, filters, dropdowns)
- **TanStack Table** â€” Data logic (filtering, sorting, grouping)
- **bazza/ui DataTableFilter** â€” Linear-inspired faceted filters

---

## New Components

| Component | Location | Purpose |
|-----------|----------|---------|
| `substack.ts` âœ… | `packages/shared/src/lib/` | RSS parser + YAML join utility |
| `SubstackPostPreview.astro` âœ… | `packages/shared/src/components/` | Substack post preview with external link |
| `AnalysisTable.tsx` | `src/components/` | React table with shadcn + TanStack |
| `GitHubContributeButton.astro` | `packages/shared/src/components/` | Subtle button linking to CONTRIBUTING.md |
| `SubscribeDialog.tsx` âœ… | `packages/shared/src/components/` | Substack subscribe modal (Phase 15) |

---

## Implementation Plan

### Chunk 1: Substack Integration â€” [#107](https://github.com/eeshansrivastava89/datascienceapps/issues/107) âœ…
1. âœ… Create `src/lib/substack.ts` (RSS parser + YAML join)
2. âœ… Create `src/data/substack-posts.yaml` (empty to start)
3. âœ… Create `SubstackPostPreview.astro` component
4. âœ… Refactor `/writing` page to use Substack RSS
5. âœ… **Test:** Verified posts render with external links

### Chunk 2: Header + Analysis Page â€” [#108](https://github.com/eeshansrivastava89/datascienceapps/issues/108) âœ…
1. âœ… Install shadcn dependencies (TanStack Table, class-variance-authority, clsx, tailwind-merge, lucide-react)
2. âœ… Update Header (removed Contribute/Writing, added Analysis + Subscribe to Substack)
3. âœ… Create `/analysis` page with shadcn Table + TanStack Table (custom dense design)
4. âœ… Extend notebook YAML schema (added `methods`, `tags`, `project_id` fields)
5. âœ… Update `analytics/lib/summary.py` to output new fields
6. âœ… Build unified data loader in `src/lib/analysis.ts` (notebooks + Substack posts)
7. âœ… Implement faceted filters with counts (Type, Project, Method dropdowns)
8. âœ… Add project grouping with actual names (not IDs)
9. âœ… Context-aware action buttons ("View Notebook" black, "View on Substack" orange)
10. âœ… Dense, scannable UI (12px text, tight spacing, no truncation)
11. âœ… **Test:** Verified filtering, grouping, sorting, hover effects all work

### Chunk 3: App Page Restructure â€” [#109](https://github.com/eeshansrivastava89/datascienceapps/issues/109) âœ…
1. âœ… Create `GitHubContributeButton.astro`
2. âœ… Restructure AB Simulator app page:
   - Add GitHubContributeButton to header
   - Add "View all notebooks & posts" link to /analysis?project=ab-simulator
   - Update existing links from /projects/ab-simulator â†’ /analysis?project=ab-simulator
3. âœ… **Test:** Full flow works (build passes)

### Chunk 4: Cleanup â€” [#110](https://github.com/eeshansrivastava89/datascienceapps/issues/110) âœ…
1. âœ… Delete `/contribute` page
2. âœ… Delete `/projects/ab-simulator.astro` hub page
3. âœ… Delete `ProjectHubLayout.astro`
4. âœ… Delete `hub-page.astro.template`
5. âœ… Update `create-package.mjs` (removed hub page generation)
6. âœ… Update `index.astro.template` (added GitHubContributeButton + Related Content sections)
7. âœ… **Test:** New package creation works with new patterns (test-app verified)

### Chunk 5: Polish â€” [#111](https://github.com/eeshansrivastava89/datascienceapps/issues/111) âœ…
1. ~~Add 301 redirects for old URLs~~ (skipped - brand new site, no redirect debt)
2. âœ… Update CLAUDE.md with new architecture
   - Updated portfolio site routes (removed /contribute, added /analysis)
   - Updated key files list (removed ProjectHubLayout, added GitHubContributeButton + analysis files)
   - Updated "Adding New Apps" section with new conventions
3. âœ… Final QA pass
   - Build passes: 9 pages generated (was 11 before cleanup)
   - Verified hub pages removed: /contribute âœ“, /projects/ab-simulator âœ“
   - Verified new pages exist: /analysis âœ“
   - Verified notebook detail pages still work: /projects/ab-simulator/analysis/ab-test-analysis âœ“

---

## File Changes Summary

| Action | Path | Status |
|--------|------|--------|
| **Create** | `src/lib/substack.ts` | âœ… |
| **Create** | `src/data/substack-posts.yaml` | âœ… |
| **Create** | `src/components/writing/SubstackPostPreview.astro` | âœ… |
| **Create** | `src/lib/analysis.ts` | âœ… |
| **Create** | `src/lib/utils.ts` | âœ… |
| **Create** | `src/pages/analysis/index.astro` | âœ… |
| **Create** | `src/components/AnalysisTable.tsx` | âœ… |
| **Create** | `src/components/ui/table.tsx` | âœ… |
| **Create** | `components.json` | âœ… |
| **Create** | `packages/shared/src/components/GitHubContributeButton.astro` | âœ… |
| **Edit** | `src/site.config.ts` | âœ… |
| **Edit** | `src/types.ts` | âœ… |
| **Edit** | `src/pages/writing/index.astro` | âœ… |
| **Edit** | `packages/shared/src/components/layout/Header.astro` | âœ… |
| **Edit** | `public/analysis/ab-simulator/ab-test-analysis.yaml` | âœ… |
| **Edit** | `analytics/lib/summary.py` | âœ… |
| **Edit** | `packages/ab-simulator/src/pages/index.astro` | âœ… |
| **Edit** | `scripts/create-package.mjs` | âœ… |
| **Edit** | `scripts/templates/index.astro.template` | âœ… |
| **Delete** | `src/pages/contribute/` | âœ… |
| **Delete** | `src/pages/projects/ab-simulator.astro` | âœ… |
| **Delete** | `src/layouts/ProjectHubLayout.astro` | âœ… |
| **Delete** | `scripts/templates/hub-page.astro.template` | âœ… |

---

## DRY Principles Applied

1. **Unified data model** â€” Single interface for notebooks + posts
2. **shadcn components** â€” Reusable, owned code (not black-box dependencies)
3. **TanStack Table** â€” One library handles filtering, sorting, grouping
4. **GitHub button** â€” Single component, reusable across all app pages
5. **Templates** â€” `create-package.mjs` generates new apps with all patterns built-in

---

## Risk Assessment

| Risk | Level | Mitigation |
|------|-------|------------|
| RSS fetch fails at build | Medium | Graceful fallback, cache last successful fetch |
| Old URLs break SEO | Low | Optional 301 redirects |
| Template changes break existing apps | Low | Only affects new packages |

---

## Success Metrics

- [x] Users can navigate home â†’ project â†’ app in 2 clicks (not 3)
- [x] `/writing` shows Substack posts with correct external links
- [x] `/analysis` shows unified notebooks + posts with dense, scannable UI
- [x] Faceted filters work (type, project, methods) with live counts
- [x] Grouping by project maintains projectâ†’content linkage (shows actual project names)
- [x] Dense UI scales well (12px text, tight spacing, no truncation)
- [x] Context-aware buttons ("View Notebook" vs "View on Substack" with color coding)
- [x] New package via `create-package.mjs` includes all patterns (GitHubContributeButton + Related Content)
- [x] No broken links in production (final QA passed)

---

# Phase 13: Charting Library Consolidation

> **Status:** Complete âœ…
> **Goal:** Replace Plotly with Apache ECharts, keep Leaflet for geo map (better tile-based UX).

---

## Why This Change?

Original charting stack was bloated:

1. **Plotly.js (3.5MB)** â€” Charts only (bar, distribution, funnel)
2. **Leaflet (300KB)** â€” Maps only (geo markers)

**Final approach:** ECharts for charts (300KB) + Leaflet for geo map (300KB). Kept Leaflet because tile-based maps provide better zoom detail (streets, cities) vs ECharts SVG-only world outline.

---

## Architecture Impact

### Before:
```
AB Simulator Dashboard
â”œâ”€â”€ Plotly.js (3.5MB) â†’ Bar, KDE, Funnel charts
â”œâ”€â”€ Leaflet (300KB)   â†’ Geo map with markers
â””â”€â”€ Custom theming    â†’ Manual dark mode per library
```

### After:
```
AB Simulator Dashboard
â”œâ”€â”€ Apache ECharts (300KB) â†’ Bar, KDE, Funnel charts
â”‚   â””â”€â”€ Unified theme system
â””â”€â”€ Leaflet (300KB)        â†’ Geo map with tile detail
    â””â”€â”€ Optimized: caching, instant pans, smooth zoom
```

**Bundle reduction:** 3,800 KB â†’ 600 KB (6x smaller)

---

## Chart Migration Map

| Chart | Before | After | Status |
|-------|--------|-------|--------|
| Average Completion Time | Plotly bar | ECharts `{ type: 'bar' }` | âœ… |
| KDE Distribution | Plotly line | ECharts `{ type: 'line', smooth: true }` | âœ… |
| Conversion Funnel | Plotly funnel | ECharts butterfly bar chart (A left, B right) | âœ… |
| Geo Markers | Leaflet tiles | Leaflet tiles (kept, optimized) | âœ… |

---

## Implementation Tasks â€” [#112](https://github.com/eeshansrivastava89/datascienceapps/issues/112)

### 1. Setup ECharts âœ…
- [x] Add ECharts CDN to `packages/ab-simulator/src/pages/index.astro`
- [x] Remove Plotly CDN link
- [x] Keep Leaflet for geo map (better UX decision)

### 2. Refactor `dashboard.js` âœ…
- [x] Replace `getPlotlyTheme()` â†’ `getEChartsTheme()`
- [x] Replace `renderAvgTimeChart()` with ECharts bar chart
- [x] Replace `renderDistributionChart()` with ECharts smooth line (kept `computeKDE()`)
- [x] Replace `renderFunnelChart()` with ECharts butterfly bar chart
- [x] Optimize `renderGeoMap()` with data caching and instant pans
- [x] Update dark mode observer for ECharts charts

### 3. Test & Verify âœ…
- [x] All charts render correctly
- [x] Dark mode toggle works
- [x] Responsive resize works
- [x] "Follow Live" mode works (instant pan to new completion)
- [x] Tooltips match design
- [x] Adaptive polling still works (3-60s backoff)

---

## File Changes

| Action | Path | Status |
|--------|------|--------|
| **Edit** | `packages/ab-simulator/src/pages/index.astro` | âœ… (swap Plotly â†’ ECharts CDN) |
| **Edit** | `packages/ab-simulator/public/js/ab-sim/dashboard.js` | âœ… (full rewrite) |

---

## Leaflet Optimizations

| Issue | Fix |
|-------|-----|
| Slow `flyTo()` animation | Use `setView({ animate: false })` for programmatic pans |
| Re-render every poll | Cache data hash, skip if unchanged |
| Map reset flicker | Keep animations ON for user interactions |
| Small reset button | Added "ðŸŒ Reset" with clear text label |
| Large markers | Reduced radius from 10 â†’ 5 |

---

## Success Metrics

- [x] Bundle size reduced from 3.8MB â†’ 600KB (6x smaller)
- [x] All 3 ECharts charts render correctly (bar, distribution, funnel)
- [x] Geo map has tile-based detail with smooth zoom
- [x] Dark mode works
- [x] "Follow Live" mode pans to most recent completion

---

# Phase 14: Related Content Section (Original V2 Vision)

> **Status:** Complete âœ…
> **Goal:** Implement fully templatized "Related Content" section on app pages with notebook summaries and Substack posts.

---

## Why This Change?

**Original V2 vision was misinterpreted.** The "Related Content" section should display:

1. **Analysis Notebooks** â€” Automated summaries with methods, findings, conclusions
2. **Related Writing** â€” Substack posts tagged with the project
3. **Placeholders** â€” Instructions when content doesn't exist yet

**Current state:** âœ… Complete â€” App pages now show inline notebook summaries and Substack posts

---

## Architecture Impact

### Final Structure:
```
App Page
â”œâ”€â”€ App Header (templatized)
â”‚   â””â”€â”€ Title, description, breadcrumbs, Analysis link
â”œâ”€â”€ ðŸŽ® Try it (H2, templatized)
â”‚   â””â”€â”€ App functionality slot with placeholder if empty
â”œâ”€â”€ ðŸ“Š Understand it (H2, templatized)
â”‚   â”œâ”€â”€ NotebookSummary with "View Notebook" button
â”‚   â””â”€â”€ Placeholder if no notebooks
â””â”€â”€ ðŸ“® Read about it (H2, templatized)
    â”œâ”€â”€ SubstackPostPreview with excerpts
    â””â”€â”€ Placeholder if no posts
```

---

## Implementation Tasks â€” [#113](https://github.com/eeshansrivastava89/datascienceapps/issues/113)

### 1. Create Content Loader Utilities âœ…
- [x] Create `getNotebooksForProject(projectId)` helper
  - Reads `public/analysis/{projectId}/*.yaml` using `fs.readdirSync`
  - Uses `findMonorepoRoot()` to work from any package
  - Returns array of notebook metadata (id, title, link, yamlPath)
- [x] Move Substack utilities to shared package
  - `packages/shared/src/lib/substack.ts` â€” RSS parser + YAML join
  - `packages/shared/src/data/substack-posts.yaml` â€” Project mappings
  - `getPostsByProject(posts, projectId)` filters posts

### 2. Create RelatedContent Component âœ…
- [x] Create `packages/shared/src/components/RelatedContent.astro`
  - Renders "ðŸ“Š Understand it" section with NotebookSummary
  - Renders "ðŸ“® Read about it" section with SubstackPostPreview
  - Shows placeholders if content missing

### 3. Integrate into AppLayout âœ…
- [x] Add `<RelatedContent>` component to `AppLayout.astro`
  - Renders automatically after app content slot
  - Three H2 sections: Try it, Understand it, Read about it
- [x] Add placeholder slot for app functionality
  - Shows instructions if slot is empty

### 4. Update NotebookSummary Component âœ…
- [x] Add `findMonorepoRoot()` to work from any package
- [x] Add "View Notebook" button in header
- [x] Add `@iconify-json/lucide` to ab-simulator for icons

### 5. Update create-package Template âœ…
- [x] Template already includes placeholder instructions
- [x] RelatedContent automatically included via AppLayout

---

## File Changes

| Action | Path | Status |
|--------|------|--------|
| **Create** | `packages/shared/src/lib/content-loader.ts` | âœ… |
| **Create** | `packages/shared/src/components/RelatedContent.astro` | âœ… |
| **Move** | `src/lib/substack.ts` â†’ `packages/shared/src/lib/substack.ts` | âœ… |
| **Move** | `src/data/substack-posts.yaml` â†’ `packages/shared/src/data/substack-posts.yaml` | âœ… |
| **Edit** | `packages/shared/src/layouts/AppLayout.astro` | âœ… (add RelatedContent + placeholder) |
| **Edit** | `packages/shared/src/components/NotebookSummary.astro` | âœ… (add View Notebook button + findMonorepoRoot) |
| **Edit** | `packages/ab-simulator/package.json` | âœ… (add @iconify-json/lucide) |
| **Edit** | `packages/ab-simulator/astro.config.mjs` | âœ… (configure lucide icons) |
| **Edit** | `src/lib/analysis.ts` | âœ… (update imports) |
| **Edit** | `src/pages/writing/index.astro` | âœ… (update imports) |
| **Edit** | `src/pages/analysis/index.astro` | âœ… (update imports) |
| **Delete** | "Explore More" block from ab-simulator | âœ… |

---

## Success Metrics

- [x] App pages show inline notebook summaries (not just links)
- [x] App pages show Substack post previews with excerpts
- [x] Empty apps show helpful placeholder instructions
- [x] "View Notebook" button works correctly (inside NotebookSummary)
- [x] New packages created via `create-package.mjs` include all patterns
- [x] Substack utilities moved to shared package for reuse across monorepo

---

# Phase 15: Architecture Cleanup â€” [#114](https://github.com/eeshansrivastava89/datascienceapps/issues/114)

> **Status:** Complete âœ…
> **Goal:** Fix brittle imports, broken features, and dead code.

---

## Summary

Eliminated architectural debt accumulated during rapid development:
- **Path aliases** â€” All deep `../../../packages/shared/src/...` imports replaced with `@shared/*`
- **Reverse dependency fixed** â€” Moved `SubscribeDialog` to shared package (was importing base â†’ shared â†’ base)
- **Dead features removed** â€” Likes/comments (broken), giscus dependency, Supabase artifacts
- **Dead code removed** â€” `hubUrl` from schema, types, YAML, templates
- **Version alignment** â€” All packages now on Astro 5.16.0
- **API surface defined** â€” Shared package exports reflect actual usage

---

## Implementation Details

### 1. Path Aliases âœ…
- Added `@shared/*` alias to root `tsconfig.json` â†’ `packages/shared/src/*`
- Added `@shared/*` alias to `packages/ab-simulator/tsconfig.json` â†’ `../shared/src/*`
- Updated 11 files across `src/pages/`, `src/lib/`, `src/components/`, `packages/ab-simulator/`
- Updated `scripts/templates/index.astro.template` for new packages

### 2. Reverse Dependency Fix âœ…
- Moved `SubscribeDialog.tsx` from `src/components/` to `packages/shared/src/components/`
- Created `packages/shared/src/components/ui/dialog.tsx` (shadcn component)
- Created `packages/shared/src/lib/utils.ts` (cn helper)
- Updated `packages/shared/src/components/layout/Header.astro` to use local import

### 3. Likes & Comments Removal âœ…
- Deleted `src/components/LikeButton.astro`
- Deleted `src/components/Comments.astro`
- Removed `@giscus/react` and `giscus` from `package.json`
- Created Supabase migration `20251224000000_drop_likes_feature.sql`:
  - Dropped `toggle_like()` and `get_likes()` RPCs
  - Dropped `v_like_counts` view
  - Dropped `likes` table and RLS policies

### 4. hubUrl Removal âœ…
- Removed from `packages/shared/src/data/projects.schema.json`
- Removed from `packages/shared/src/lib/projects.ts` (Project interface)
- Removed from `packages/shared/src/data/projects/ab-simulator.yaml`
- Removed from `scripts/templates/project.yaml.template`

### 5. Version Alignment âœ…
- Upgraded root `astro` from `^4.4.15` to `^5.16.0`
- Upgraded `@astrojs/mdx` from `^2.1.1` to `^4.0.0`
- Upgraded `astro-expressive-code` from `^0.33.5` to `^0.38.0`

### 6. Shared Exports Cleanup âœ…
- Removed stale `./learnings` export (file didn't exist)
- Added exports for: `lib/projects`, `lib/substack`, `lib/content-loader`, `lib/utils`, `data/projectLoader`, `layouts/AppLayout.astro`, `components/Breadcrumbs.astro`, `components/ProjectCard.astro`, `components/Timeline.astro`, `components/GitHubContributeButton.astro`, `components/SubstackPostPreview.astro`, `components/SubscribeDialog`

---

## Success Metrics

- [x] No deep relative imports (`../../../packages/shared/src/...`)
- [x] No reverse dependencies (shared â†’ base)
- [x] All packages on same Astro version (5.16.0)
- [x] Shared package exports match actual files
- [x] Build passes (7 pages in ~2.5s)

---

# Phase 16: QA Automation

> **Status:** Deferred â¸ï¸
> **Goal:** Add automated regression detection for core site flows, UI stability, and content integrity.

---

## Why Deferred?

The ROI is negative for a 1-app portfolio with a single developer:

| Proposed | Reality |
|----------|---------|
| Playwright smoke tests | Manual QA takes 2 minutes. Build already validates routes. |
| Visual regression | You see every change. No CSS drift risk. |
| Lighthouse CI | Astro static sites are already fast. No perf issues. |
| YAML validation | Build fails on malformed YAML. Already caught. |

**Current coverage is sufficient:**
- `pnpm build` validates imports, TypeScript, YAML, and generates all pages
- RPC smoke checks run on schedule for Supabase

---

## Revisit When

- **3+ apps** â€” Add Playwright smoke tests for each route
- **External contributors** â€” Add visual regression to catch CSS mistakes
- **Performance issues** â€” Add Lighthouse CI with failing thresholds
- **Broken YAML shipped twice** â€” Add schema validation

---

## Lightweight Alternative (If Needed Later)

Single Playwright test (~15 min to set up):
```typescript
test('core pages load without errors', async ({ page }) => {
  for (const route of ['/', '/ab-simulator/', '/analysis']) {
    await page.goto(route)
    expect(page.locator('body')).toBeVisible()
  }
})
```

This catches 80% of regressions with minimal maintenance.
